<html>

    <head>

        <script type="text/javascript">

            const INACTIVITY_THRESHOLD_SECONDS_PAGE = 3;
            const INACTIVITY_THRESHOLD_SECONDS_WIDGET = 5;

            let inactivity_timer_page;
            let inactivity_timer_widget;

            document.onreadystatechange = function() {

                if (document.readyState === 'complete') {

                    loadHelpshiftChatWidget();

                    activateListeners();

                    startPageActivityWatcher();
                }
            }

            function activateListeners() {

                Helpshift('addEventListener', 'conversationStart', handleEvent_conversationStart);
                Helpshift(`addEventListener`, 'widgetToggle', handleEvent_widgetToggle);
            }

            function loadHelpshiftChatWidget() {
                
                (function () {
                    var PLATFORM_ID = "doctorswithoutborders_platform_20200730203821254-061ccff47c40613",
                    DOMAIN = "doctorswithoutborders",
                    LANGUAGE = "en";

                    window.helpshiftConfig = {
                        platformId: PLATFORM_ID,
                        domain: DOMAIN,
                        language: LANGUAGE
                    };
                }) ();

                !function(t,e){if("function"!=typeof window.Helpshift){var n=function(){n.q.push(arguments)};n.q=[],window.Helpshift=n;var i,a=t.getElementsByTagName("script")[0];if(t.getElementById(e))return;i=t.createElement("script"),i.async=!0,i.id=e,i.src="https://webchat.helpshift.com/webChat.js";var o=function(){window.Helpshift("init")};window.attachEvent?i.attachEvent("onload",o):i.addEventListener("load",o,!1),a.parentNode.insertBefore(i,a)}else window.Helpshift("update")}(document,"hs-chat");

                // Helpshift('show');
            }

            function handleEvent_conversationStart(p_data) {

                if (!(p_data instanceof Object)) {
                    throw new TypeError(`The first parameter of this function must be an Object instance: ${p_data}`);
                }

                stopWidgetActivityWatcher();

                console.log(`The user started the conversation, so the widget activity watcher was cleared.`);
            }

            function handleEvent_messageAdd(p_data) {

                if (!(p_data instanceof Object)) {
                    throw new TypeError(`The first parameter of this function must be an Object instance: ${p_data}`);
                }

                stopWidgetActivityWatcher();

                console.log(`The user sent a message, so the widget activity watcher was cleared.`);
            }

            function handleEvent_pageActivity(p_data) {

                if (!(p_data instanceof Object)) {
                    throw new TypeError(`The first parameter of this function must be an Object instance: ${p_data}`);
                }

                stopPageActivityWatcher();

                console.log(`Some activity occurred on the page, so the page activity watcher was cleared.`);
            }

            function handleEvent_widgetToggle(p_data) {

                if (!(p_data instanceof Object)) {
                    throw new TypeError(`The first parameter of this function must be an Object instance: ${p_data}`);
                }

                if (p_data.visible === 'true') {
                    
                    stopPageActivityWatcher();

                    console.log(`The widget was opened manually, so the page activity watcher was cleared.`);
                }
            }

            function startPageActivityWatcher() {

                let timer_max = INACTIVITY_THRESHOLD_SECONDS_PAGE * 1000;

                inactivity_timer_page = setTimeout(function() {
                    
                    Helpshift('open');

                    startWidgetActivityWatcher();

                    console.log(`The timer threshold (${INACTIVITY_THRESHOLD_SECONDS_PAGE}s) for inactivity on the page has been reached, so the widget was opened.`);

                }, timer_max);
            }

            function stopPageActivityWatcher() {

                clearTimeout(inactivity_timer_page);
            }

            function startWidgetActivityWatcher() {

                inactivity_timer_widget = setTimeout(function() {
                    Helpshift('close');
                }, INACTIVITY_THRESHOLD_SECONDS_WIDGET * 1000);
            }

            function stopWidgetActivityWatcher() {

                clearTimeout(inactivity_timer_widget);
            }

        </script>

    </head>

    <body>
        
    </body>
</html>